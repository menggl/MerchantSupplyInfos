<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>选择机型</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f0f2f5; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .phone-frame { width: 375px; height: 667px; background-color: #f7f8fa; border-radius: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; display: flex; flex-direction: column; position: relative; border: 12px solid #333; }
        
        /* 顶部导航栏 - 复用但微调 */
        .nav-bar { background-color: #1890FF; padding: 44px 15px 10px; display: flex; align-items: center; justify-content: space-between; color: #fff; flex-shrink: 0; border-bottom: 1px solid #e5e5e5; }
        .nav-title { font-size: 18px; font-weight: 600; flex: 1; text-align: center; }
        .nav-btn { color: #fff; font-size: 15px; cursor: pointer; border: none; background: none; padding: 5px; }

        /* 主体布局 - 复用 search_mockup.html */
        .content-container { flex: 1; display: flex; overflow: hidden; background-color: #fff; }
        
        /* 左侧品牌栏 */
        .sidebar { width: 90px; background-color: #f7f8fa; overflow-y: auto; border-right: 1px solid #eee; flex-shrink: 0; }
        .brand-item { height: 50px; display: flex; align-items: center; justify-content: center; font-size: 14px; color: #333; position: relative; cursor: pointer; }
        .brand-item.active { background-color: #fff; color: #4facfe; font-weight: bold; }
        .brand-item.active::before { content: ''; position: absolute; left: 0; top: 15px; bottom: 15px; width: 4px; background-color: #4facfe; border-radius: 0 2px 2px 0; }

        /* 右侧内容区 */
        .main-area { flex: 1; overflow-y: auto; display: flex; flex-direction: column; position: relative; }

        /* 选择器组 - 模仿搜索界面 */
        .selector-group { background-color: #fff; padding: 20px 15px; }
        .selector-item { background-color: #f5f5f5; height: 44px; border-radius: 8px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; font-size: 14px; color: #333; cursor: pointer; }
        .selector-item span { color: #666; }
        .selector-item.filled { color: #333; font-weight: 500; }
        
        /* 下一步按钮 - 模仿搜索按钮 */
        .action-btn { background: #4facfe; color: white; height: 44px; border-radius: 22px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; margin: 10px 15px; box-shadow: 0 4px 10px rgba(79, 172, 254, 0.3); cursor: pointer; }
        .action-btn:active { opacity: 0.9; }

        /* 列表选择视图 (Modal style within main area) */
        .list-selection-view { display: none; width: 100%; flex: 1; overflow-y: auto; background: #fff; }
        .list-item { height: 50px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; padding: 0 15px; font-size: 14px; color: #333; cursor: pointer; justify-content: space-between; }
        .list-item:active { background-color: #f9f9f9; }
        .list-header { padding: 10px 15px; background: #f0f5ff; color: #666; font-size: 12px; display: flex; justify-content: space-between; align-items: center; }
        .btn-close-list { color: #4facfe; font-weight: bold; cursor: pointer; }

        /* 状态控制 */
        .form-view { display: block; }
        
        /* 底部导航栏 */
        .tab-bar { height: 83px; background-color: #fff; border-top: 1px solid #e5e5e5; display: flex; padding-bottom: 20px; flex-shrink: 0; }
        .tab-item { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #999; cursor: pointer; font-size: 10px; }
        .tab-item.active { color: #4facfe; }
        .tab-icon { width: 24px; height: 24px; margin-bottom: 4px; background-color: currentColor; mask-size: contain; -webkit-mask-size: contain; mask-repeat: no-repeat; -webkit-mask-repeat: no-repeat; mask-position: center; -webkit-mask-position: center; }
        .icon-home { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z'/%3E%3C/svg%3E"); }
        .icon-search { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z'/%3E%3C/svg%3E"); }
        .icon-request { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z'/%3E%3C/svg%3E"); }
        .icon-me { -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E"); mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E"); }
    </style>
</head>
<body>
    <div class="phone-frame">
        <div class="nav-bar">
            <button class="nav-btn" onclick="history.back()">取消</button>
            <div class="nav-title">选择机型</div>
            <div style="width: 32px;"></div>
        </div>

        <div class="content-container">
            <!-- 左侧品牌 -->
            <div class="sidebar" id="sidebar">
                <!-- 动态生成 -->
            </div>

            <!-- 右侧主区域 -->
            <div class="main-area">
                
                <!-- 表单视图 -->
                <div id="form-view" class="form-view">
                    <div class="selector-group">
                        <div class="selector-item" onclick="openList('series')">
                            <span id="text-series">请选择系列</span>
                            <span>&gt;</span>
                        </div>
                        <div class="selector-item" onclick="openList('model')">
                            <span id="text-model">请选择型号</span>
                            <span>&gt;</span>
                        </div>
                        <div class="selector-item" onclick="openList('config')">
                            <span id="text-config">请选择配置</span>
                            <span>&gt;</span>
                        </div>
                    </div>
                    
                    <div class="action-btn" onclick="goToNext()">下一步</div>
                </div>

                <!-- 列表选择视图 -->
                <div id="list-view" class="list-selection-view">
                    <div class="list-header">
                        <span id="list-title">选择系列</span>
                        <span class="btn-close-list" onclick="closeList()">取消</span>
                    </div>
                    <div id="list-container">
                        <!-- 动态列表 -->
                    </div>
                </div>

            </div>
        </div>
        
        <div class="tab-bar">
            <div class="tab-item" onclick="location.href='home_mockup.html'">
                <div class="tab-icon icon-home"></div>
                <span>首页</span>
            </div>
            <div class="tab-item active">
                <div class="tab-icon icon-search"></div>
                <span>查询</span>
            </div>
            <div class="tab-item" onclick="location.href='listings_mockup.html'">
                <div class="tab-icon icon-request"></div>
                <span>求购</span>
            </div>
            <div class="tab-item" onclick="location.href='me_mockup.html'">
                <div class="tab-icon icon-me"></div>
                <span>我的</span>
            </div>
        </div>
    </div>

    <script>
        const pageParams = new URLSearchParams(location.search);
        const mode = pageParams.get('mode') || 'request';
        // 模拟数据结构
        const data = {
            'Apple': {
                name: '苹果',
                series: {
                    'iPhone 15 系列': {
                        models: {
                            'iPhone 15': ['黑色 128G', '黑色 256G', '蓝色 128G', '蓝色 256G'],
                            'iPhone 15 Pro': ['原色 256G', '原色 512G', '蓝色 256G'],
                            'iPhone 15 Pro Max': ['原色 256G', '原色 512G', '黑色 512G']
                        }
                    },
                    'iPhone 14 系列': {
                        models: {
                            'iPhone 14': ['午夜色 128G', '星光色 128G'],
                            'iPhone 14 Pro': ['暗紫色 256G', '金色 256G']
                        }
                    }
                }
            },
            'Huawei': {
                name: '华为',
                series: {
                    'Mate 60 系列': {
                        models: {
                            'Mate 60': ['雅川青 12+512', '白沙银 12+512'],
                            'Mate 60 Pro': ['雅川青 12+512', '雅川青 12+1TB', '白沙银 12+512']
                        }
                    },
                    'P60 系列': {
                        models: {
                            'P60': ['洛可可白 256G'],
                            'P60 Pro': ['洛可可白 256G', '羽砂黑 256G']
                        }
                    }
                }
            },
            'Xiaomi': {
                name: '小米',
                series: {
                    'Xiaomi 14': {
                        models: {
                            'Xiaomi 14': ['黑色 16+512'],
                            'Xiaomi 14 Pro': ['黑色 16+512', '钛金属']
                        }
                    }
                }
            }
        };

        let currentBrand = 'Apple';
        let selection = {
            series: null,
            model: null,
            config: null
        };
        let currentListType = null; // 'series', 'model', 'config'

        function init() {
            renderSidebar();
            updateFormUI();
        }

        function renderSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.innerHTML = '';
            for (let key in data) {
                const item = document.createElement('div');
                item.className = `brand-item ${key === currentBrand ? 'active' : ''}`;
                item.textContent = data[key].name;
                item.onclick = () => selectBrand(key);
                sidebar.appendChild(item);
            }
        }

        function selectBrand(brandKey) {
            if (currentBrand === brandKey) return;
            currentBrand = brandKey;
            // Reset selections
            selection = { series: null, model: null, config: null };
            renderSidebar();
            updateFormUI();
            closeList(); // Close list if open
        }

        function updateFormUI() {
            const setUI = (id, val, defaultText) => {
                const el = document.getElementById('text-' + id);
                if (val) {
                    el.textContent = val;
                    el.parentElement.classList.add('filled');
                } else {
                    el.textContent = defaultText;
                    el.parentElement.classList.remove('filled');
                }
            };

            setUI('series', selection.series, '请选择系列');
            setUI('model', selection.model, '请选择型号');
            setUI('config', selection.config, '请选择配置');
        }

        function openList(type) {
            // Validation dependency
            if (type === 'model' && !selection.series) {
                alert('请先选择系列');
                return;
            }
            if (type === 'config' && !selection.model) {
                alert('请先选择型号');
                return;
            }

            currentListType = type;
            const listView = document.getElementById('list-view');
            const formView = document.getElementById('form-view');
            const listContainer = document.getElementById('list-container');
            const listTitle = document.getElementById('list-title');

            formView.style.display = 'none';
            listView.style.display = 'block';
            listContainer.innerHTML = '';

            let items = [];
            let clickHandler = null;

            if (type === 'series') {
                listTitle.textContent = '选择系列';
                items = Object.keys(data[currentBrand].series);
                clickHandler = (val) => {
                    selection.series = val;
                    selection.model = null; // Reset children
                    selection.config = null;
                };
            } else if (type === 'model') {
                listTitle.textContent = '选择型号';
                items = Object.keys(data[currentBrand].series[selection.series].models);
                clickHandler = (val) => {
                    selection.model = val;
                    selection.config = null; // Reset child
                };
            } else if (type === 'config') {
                listTitle.textContent = '选择配置';
                items = data[currentBrand].series[selection.series].models[selection.model];
                clickHandler = (val) => {
                    selection.config = val;
                };
            }

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.textContent = item;
                div.onclick = () => {
                    clickHandler(item);
                    updateFormUI();
                    closeList();
                    // Auto-advance logic (optional, but helpful)
                    if (type === 'series') setTimeout(() => openList('model'), 200);
                    else if (type === 'model') setTimeout(() => openList('config'), 200);
                };
                listContainer.appendChild(div);
            });
        }

        function closeList() {
            document.getElementById('list-view').style.display = 'none';
            document.getElementById('form-view').style.display = 'block';
            currentListType = null;
        }

        function goToNext() {
            if (!selection.series || !selection.model || !selection.config) {
                alert('请完整选择系列、型号和配置');
                return;
            }

            const params = new URLSearchParams({
                brand: data[currentBrand].name,
                series: selection.series,
                model: selection.model,
                config: selection.config,
                mode,
                type: pageParams.get('type') || ''
            });
            location.href = 'publish_request_mockup.html?' + params.toString();
        }

        init();
    </script>
</body>
</html>
