[toc]

# 一、字典数据接口文档

- 基础地址：`http://localhost:8083`
- 全部接口返回 `application/json`
- 数据均按 `sort` 字段升序排列；逻辑删除（`deleted=1`）的数据已被过滤

## 1. 获取完整字典层级
- 方法与地址：`GET /api/dict/all`
- 功能：返回品牌 → 系列 → 型号 → 配置的完整层级数据
- 说明：该接口的下级对象中父级 ID 字段可能为空（仅包含本级的 `*_id`、`*_name`、`sort` 以及下一级数组）
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/dict/all" -H "Accept: application/json"
```
- 返回示例：
```json
[
  {
    "brand_id": 1,
    "brand_name": "Apple",
    "sort": 1,
    "seriesArr": [
      {
        "series_id": 10,
        "series_name": "iPhone",
        "sort": 1,
        "modelArr": [
          {
            "model_id": 100,
            "model_name": "iPhone 13",
            "sort": 1,
            "specArr": [
              { "spec_id": 1000, "spec_name": "128GB", "sort": 1 },
              { "spec_id": 1001, "spec_name": "256GB", "sort": 2 }
            ]
          }
        ]
      }
    ]
  }
]
```

## 2. 获取所有品牌
- 方法与地址：`GET /api/dict/brands`
- 功能：返回全部品牌的基础信息
- 字段：`brand_id`、`brand_name`、`sort`
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/dict/brands" -H "Accept: application/json"
```
- 返回示例：
```json
[
  { "brand_id": 1, "brand_name": "Apple", "sort": 1 },
  { "brand_id": 2, "brand_name": "Huawei", "sort": 2 }
]
```

## 3. 根据品牌获取系列
- 方法与地址：`GET /api/dict/series/{brandId}`
- 功能：根据品牌 ID 返回该品牌下的全部系列
- 路径参数：
  - `brandId`：品牌 ID（必填）
- 字段：`brand_id`、`series_id`、`series_name`、`sort`
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/dict/series/1" -H "Accept: application/json"
```
- 返回示例：
```json
[
  { "brand_id": 1, "series_id": 10, "series_name": "iPhone", "sort": 1 },
  { "brand_id": 1, "series_id": 11, "series_name": "iPad",   "sort": 2 }
]
```
- 说明：当 `brandId` 不存在时返回空数组 `[]`

## 4. 根据系列获取型号
- 方法与地址：`GET /api/dict/models/{seriesId}`
- 功能：根据系列 ID 返回该系列下的全部型号
- 路径参数：
  - `seriesId`：系列 ID（必填）
- 字段：`brand_id`、`series_id`、`model_id`、`model_name`、`sort`
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/dict/models/10" -H "Accept: application/json"
```
- 返回示例：
```json
[
  { "brand_id": 1, "series_id": 10, "model_id": 100, "model_name": "iPhone 13", "sort": 1 },
  { "brand_id": 1, "series_id": 10, "model_id": 101, "model_name": "iPhone 14", "sort": 2 }
]
```
- 说明：当 `seriesId` 不存在时返回空数组 `[]`

## 5. 根据型号获取配置
- 方法与地址：`GET /api/dict/specs/{modelId}`
- 功能：根据型号 ID 返回该型号下的全部配置
- 路径参数：
  - `modelId`：型号 ID（必填）
- 字段：`brand_id`、`series_id`、`model_id`、`spec_id`、`spec_name`、`sort`
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/dict/specs/100" -H "Accept: application/json"
```
- 返回示例：
```json
[
  { "brand_id": 1, "series_id": 10, "model_id": 100, "spec_id": 1000, "spec_name": "128GB", "sort": 1 },
  { "brand_id": 1, "series_id": 10, "model_id": 100, "spec_id": 1001, "spec_name": "256GB", "sort": 2 }
]
```
- 说明：当 `modelId` 不存在时返回空数组 `[]`

## 6. 获取城市列表
- 方法与地址：`GET /api/dict/cities`
- 功能：返回有效城市列表，按 `sort` 升序排列，并将“全国”置于首位
- 规则：仅返回 `valid=1` 的城市；排序依据为 `sort` 字段而非城市名称
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/dict/cities" -H "Accept: application/json"
```
- 返回示例：
```json
[
  { "city_code": "000000", "city_name": "全国" },
  { "city_code": "310000", "city_name": "上海" },
  { "city_code": "370100", "city_name": "济南" }
]
```

## 7. 获取新机备注列表
- 方法与地址：`GET /api/dict/phone-remark`
- 功能：返回新机备注选项列表
- 规则：筛选 `type=0` 且 `valid=1` 的记录；按 `sort` 字段升序排列
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/dict/phone-remark" -H "Accept: application/json"
```
- 返回示例：
```json
[
  { "id": 1, "remark": "原封" },
  { "id": 2, "remark": "后封" }
]
```

## 8. 获取新机其它备注列表
- 方法与地址：`GET /api/dict/phone-model-remark`
- 功能：返回新机其它备注选项列表
- 规则：筛选 `type=1` 且 `valid=1` 的记录；按 `sort` 字段升序排列
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/dict/phone-model-remark" -H "Accept: application/json"
```
- 返回示例：
```json
[
  { "id": 1, "remark": "默认" },
  { "id": 2, "remark": "禁止出省" }
]
```

## 9. 获取二手机版本列表
- 方法与地址：`GET /api/dict/phone-model-version`
- 功能：返回二手机版本选项列表
- 规则：筛选 `type=2` 且 `valid=1` 的记录；按 `sort` 字段升序排列
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/dict/phone-model-version" -H "Accept: application/json"
```
- 返回示例：
```json
[
  { "id": 1, "remark": "大陆国行" },
  { "id": 2, "remark": "海外无锁" }
]
```

## 10. 获取二手手机成色列表
- 方法与地址：`GET /api/dict/phone-model-condition`
- 功能：返回二手手机成色选项列表
- 规则：筛选 `type=3` 且 `valid=1` 的记录；按 `sort` 字段升序排列
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/dict/phone-model-condition" -H "Accept: application/json"
```
- 返回示例：
```json
[
  { "id": 1, "remark": "全新未拆封" },
  { "id": 2, "remark": "几乎全新" }
]
```

## 11. 获取二手手机维修和功能列表
- 方法与地址：`GET /api/dict/phone-model-maintenance`
- 功能：返回二手手机维修和功能选项列表
- 规则：筛选 `type=4` 且 `valid=1` 的记录；按 `sort` 字段升序排列
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/dict/phone-model-maintenance" -H "Accept: application/json"
```
- 返回示例：
```json
[
  { "id": 1, "remark": "无任何维修" },
  { "id": 2, "remark": "屏幕有维修" }
]
```

# 二、商家登录相关接口

## 1. 微信小程序登录
- 方法与地址：`POST /api/wx-login`
- 功能：接收微信小程序的 `code`，换取 openid。如果商户不存在则自动创建（此时部分字段为空）；如果存在则更新 Token 并返回最新商户信息。
- 请求体：
```json
{ "code": "微信小程序登录返回的code" }
```

- curl 示例：
```bash
curl -X POST "http://localhost:8083/api/wx-login" \
  -H "Content-Type: application/json" \
  -d '{ "code": "081......" }'
```
- 返回示例：
```json
{
  "merchant": {
    "id": 1,
    "wechatId": "wx_test_0001",
    "token": "token_0001",
    "wechatName": "张三",
    "merchantName": "张三通讯",
    "merchantPhone": "13800000001",
    "merchantAddress": "济南市历下区泉城路1号",
    "merchantLatitude": 36.666666,
    "merchantLongitude": 117.000000,
    "contactName": "张三",
    "isMember": 1,
    "memberExpireDate": "2026-12-31T23:59:59",
    "registrationDate": "2026-01-10T09:00:00",
    "cancellationDate": null,
    "isValid": 1,
    "createTime": "2026-01-13T08:02:39",
    "updateTime": "2026-01-13T08:02:39",
    "code": null
  }
}
```
- 说明：
  - 若为新用户，返回的 `merchant` 对象中 `merchantName`、`merchantPhone` 等字段可能为 `null`，此时前端应引导用户完善注册信息。
  - 登录成功后，后端会生成新的 `token` 并返回，后续请求需使用该 `token`。


## 2. 获取图形验证码
- 方法与地址：`GET /api/sms/captcha`
- 功能：获取图形验证码图片（Base64），用于发送短信前的校验；需登录。
- 请求头：
  - `Authorization: Bearer <token>`
- 参数：
  - `phone`: 手机号（用于绑定生成的验证码）
- 返回示例：
```json
{
  "imageBase64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAoCAIAAAC..."
}
```

## 3. 发送短信验证码
- 方法与地址：`POST /api/sms/send-code`
- 功能：给指定手机号发送短信验证码，随机生成6位数验证码，有效期5分钟。需提供图形验证码校验。
- 请求头：
  - `Authorization: Bearer <token>`
- 请求体：
```json
{
  "phone": "13800000001",
  "captchaCode": "1234"
}
```
- 说明：
  - 图形验证码与 `wechatId+phone` 绑定，发送短信时只需提供 `captchaCode`。
  - 一个微信号一天最多发送5次。
- curl 示例：
```bash
curl -X POST "http://localhost:8083/api/sms/send-code" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer token_0001" \
  -d '{ "phone": "13800000001", "captchaCode": "1234" }'
```
- 返回示例（成功）：
```json
{ "status": "success" }
```
- 返回示例（失败）：
```json
{ "errorCode": "CAPTCHA_INVALID" }
```

## 4. 更新商户信息
- 方法与地址：`PUT /api/merchants/update`
- 功能：更新商户的基本信息（名称、联系人、电话、地址、经纬度）。
- 请求头：
  - `Authorization: Bearer <token>`
- 请求体：
```json
{
  "merchantName": "张三通讯",
  "contactName": "张三",
  "merchantPhone": "13800000001",
  "merchantAddress": "济南市历下区泉城路1号",
  "merchantLatitude": 36.666666,
  "merchantLongitude": 117.000000,
  "code": "123456"
}
```
- 说明：
  - `code` 字段为手机验证码，当修改手机号时必须提供且验证通过。
  - 经纬度字段 `merchantLatitude` 和 `merchantLongitude` 为必填项。
- curl 示例：
```bash
curl -X PUT "http://localhost:8083/api/merchants/update" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer token_0001" \
  -d '{
    "merchantName": "张三通讯",
    "contactName": "张三",
    "merchantPhone": "13800000001",
    "merchantAddress": "济南市历下区泉城路1号",
    "merchantLatitude": 36.666666,
    "merchantLongitude": 117.000000,
    "code": "123456"
  }'
```
- 返回示例：
```json
{
  "id": 1,
  "wechatId": "wx_test_0001",
  "token": "token_0001",
  "wechatName": "张三",
  "merchantName": "张三通讯",
  "merchantPhone": "13800000001",
  "merchantAddress": "济南市历下区泉城路1号",
  "merchantLatitude": 36.666666,
  "merchantLongitude": 117.000000,
  "contactName": "张三",
  "isMember": 1,
  "memberExpireDate": "2026-12-31T23:59:59",
  "registrationDate": "2026-01-10T09:00:00",
  "cancellationDate": null,
  "isValid": 1,
  "createTime": "2026-01-13T08:02:39",
  "updateTime": "2026-01-13T08:02:39",
  "code": null
}
```

# 三、商家上架产品相关接口

## 1. 商家上架新机、二手机
- 方法与地址：`POST /api/merchants/products`
- 功能：当前登录商户上架新机或二手机商品，成功后返回创建好的商品信息。
- 请求头：
  - `Authorization: Bearer <token>`
- 请求体：
  - 公共字段：
    - `brand`: 品牌对象，至少包含 `id`
    - `series`: 系列对象，至少包含 `id`
    - `model`: 型号对象，至少包含 `id`
    - `spec`: 配置对象，至少包含 `id`
    - `cityCode`: 城市编码
    - `productType`: 商品类型，`0` 新机，`1` 二手机（必填）
    - `description`: 产品描述
    - `price`: 价格（>0 的整数）
    - `stock`: 库存（>=0 的整数）
  - 新机（`productType = 0`）额外必填字段：
    - `remark`: 新机备注，如“原封”“后封”等
    - `otherRemark`: 新机其它备注，如“当天发货”等
  - 二手机（`productType = 1`）额外必填字段：
    - `secondHandVersion`: 二手机版本，如“大陆国行”“海外无锁”等
    - `secondHandCondition`: 成色，如“几乎全新”等
    - `secondHandFunction`: 拆修和功能情况，如“无任何维修”等
    - `images`: 图片列表，数组，至少包含 1 条有效图片
      - 每个元素：
        - `imageUrl`: 图片完整 URL
- 请求体示例（上架新机）：
```json
{
  "brand": { "id": 1 },
  "series": { "id": 10 },
  "model": { "id": 100 },
  "spec": { "id": 1000 },
  "cityCode": "370100",
  "productType": 0,
  "remark": "保证全国纯原",
  "otherRemark": "当天发货",
  "description": "全新未拆封，正品保证",
  "price": 9999,
  "stock": 10
}
```
- 请求体示例（上架二手机）：
```json
{
  "brand": { "id": 1 },
  "series": { "id": 10 },
  "model": { "id": 101 },
  "spec": { "id": 1001 },
  "cityCode": "510100",
  "productType": 1,
  "secondHandVersion": "大陆国行",
  "secondHandCondition": "细微磕碰划痕",
  "secondHandFunction": "无任何维修",
  "description": "个人自用一手，成色很好",
  "price": 3500,
  "stock": 1,
  "images": [
    { "imageUrl": "https://example.com/products/iphone15_1.jpg" }
  ]
}
```
- curl 示例：
```bash
curl -X POST "http://localhost:8083/api/merchants/products" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer token_0001" \
  -d '{
    "brand": { "id": 1 },
    "series": { "id": 10 },
    "model": { "id": 100 },
    "spec": { "id": 1000 },
    "cityCode": "370100",
    "productType": 0,
    "remark": "保证全国纯原",
    "otherRemark": "当天发货",
    "description": "全新未拆封，正品保证",
    "price": 9999,
    "stock": 10
  }'
```
- 返回示例：
```json
{
  "id": 1,
  "merchant": { "id": 1 },
  "brand": { "id": 1, "brandName": "苹果" },
  "series": { "id": 10, "seriesName": "iPhone" },
  "model": { "id": 100, "modelName": "iPhone 16 Pro Max" },
  "spec": { "id": 1000, "specName": "1TB 黑色" },
  "cityCode": "370100",
  "productType": 0,
  "remark": "保证全国纯原",
  "otherRemark": "当天发货",
  "secondHandVersion": null,
  "secondHandCondition": null,
  "secondHandFunction": null,
  "batteryStatus": null,
  "description": "全新未拆封，正品保证",
  "price": 9999,
  "stock": 10,
  "listingTime": "2026-01-14T09:00:00",
  "isValid": 1,
  "createTime": "2026-01-14T09:00:00",
  "updateTime": "2026-01-14T09:00:00",
  "images": [
    { "id": 1, "imageUrl": "https://example.com/products/iphone16promax_1.jpg" }
  ]
}
```
- 说明：
  - 该接口只能操作当前登录商户自身的商品。
  - 若商户未登录，返回 401。
  - 若商户会员已过期，返回 400，错误信息为“商户会员已过期”。
  - 若参数校验失败（例如缺少必填字段），返回 400，错误信息为对应的中文提示。



## 2. 删除商户已上架的商品
- 方法与地址：`DELETE /api/merchants/products/{productId}`
- 功能：删除当前登录商户已上架的某个商品，实际上为逻辑删除（将 `isValid` 置为 `0`），后续查询接口将不再返回此商品。
- 请求头：
  - `Authorization: Bearer <token>`
- 路径参数：
  - `productId`：商品 ID（必填）
- 行为说明：
  - 仅允许删除当前登录商户自己的商品，删除其他商户商品会返回 400 错误（“无权操作该商品”）。
  - 已删除（`isValid=0`）的商品再次删除不会报错，但不会产生任何效果。
  - 删除后，该商品不会出现在分页查询和按机型查询接口中。
- curl 示例：
```bash
curl -X DELETE "http://localhost:8083/api/merchants/products/1" \
  -H "Authorization: Bearer token_0001"
```

## 3. 修改商品上架状态（上架 / 下架）
- 方法与地址：`PUT /api/merchants/products/{productId}/state`
- 功能：修改当前登录商户某个商品的上架状态，仅修改 `state` 字段，不影响 `isValid`（是否删除）。
- 请求头：
  - `Authorization: Bearer <token>`
- 路径参数：
  - `productId`：商品 ID（必填）
- 查询参数：
  - `state`：商品状态（必填）
    - `1`：上架
    - `0`：下架
- 行为说明：
  - 仅允许操作当前登录商户自己的商品，否则返回 400 错误（“无权操作该商品”）。
  - 只能操作 `isValid=1` 的有效商品；已删除的商品会返回 400 错误（“商品不存在”）。
  - 新建商品或修改商品信息后，默认 `state=0`，需要调用本接口将其上架。
- curl 示例（下架商品）：
```bash
curl -X PUT "http://localhost:8083/api/merchants/products/1/state?state=0" \
  -H "Authorization: Bearer token_0001"
```

## 4. 修改已存在的商品信息
- 方法与地址：`PUT /api/merchants/products/{productId}`
- 功能：修改当前登录商户已存在的一条商品信息，修改完成后商品自动变为下架状态（`state=0`），需要再手动调用上架接口。
- 请求头：
  - `Authorization: Bearer <token>`
- 路径参数：
  - `productId`：商品 ID（必填）
- 请求体：
  - 字段与「商家上架新机、二手机」接口相同（支持修改品牌、系列、型号、配置及所有业务字段）。
- 行为说明：
  - 仅允许修改当前登录商户自己的商品，否则返回 400 错误（“无权操作该商品”）。
  - 只能修改 `isValid=1` 的商品；已删除的商品会返回 400 错误（“商品已删除”）。
  - 修改成功后，商品 `state` 会被重置为 `0`（下架），需要再调用 `PUT /api/merchants/products/{productId}/state` 将其上架。
- curl 示例：
```bash
curl -X PUT "http://localhost:8083/api/merchants/products/1" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer token_0001" \
  -d '{
    "brand": { "id": 1 },
    "series": { "id": 10 },
    "model": { "id": 100 },
    "spec": { "id": 1000 },
    "cityCode": "370100",
    "productType": 0,
    "remark": "修改后的备注",
    "otherRemark": "修改后的其它备注",
    "description": "更新后的商品描述",
    "price": 8888,
    "stock": 5
  }'
```

## 5. 按机型查询商户已上架的商品
- 方法与地址：`GET /api/merchants/products/model`
- 功能：根据品牌、系列、型号、配置查询当前登录商户已上架的单个商品信息。前端常用此接口判断是否已存在该型号商品：若存在则走修改流程，不存在才允许新增。
- 请求头：
  - `Authorization: Bearer <token>`
- 查询参数：
  - `brandId`：品牌 ID（必填）
  - `seriesId`：系列 ID（必填）
  - `modelId`：型号 ID（必填）
  - `specId`：配置 ID（必填）
- 行为说明：
  - 仅返回当前登录商户、且 `isValid=1` 的商品。
  - 若对应商品不存在，将返回 400 错误，错误信息为“商品不存在”。
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/merchants/products/model?brandId=1&seriesId=10&modelId=100&specId=1000" \
  -H "Authorization: Bearer token_0001"
```
- 返回示例：
```json
{
  "id": 1,
  "brand": { "id": 1, "brandName": "Apple" },
  "series": { "id": 10, "seriesName": "iPhone" },
  "model": { "id": 100, "modelName": "iPhone 13" },
  "spec": { "id": 1000, "specName": "128GB" },
  "price": 5000,
  "stock": 10,
  "isValid": 1,
  "updateTime": "2026-01-14T10:00:00",
  "listingTime": "2026-01-14T09:00:00",
  "productType": 0,
  "cityCode": "310000",
  "description": "全新未拆封"
}
```
## 6. 查询商户已经上架了的商品
- 方法与地址：`GET /api/merchants/products`
- 功能：分页查询当前登录商户已上架的商品列表，按更新时间倒序排列。
- 请求头：
  - `Authorization: Bearer <token>`
- 参数：
  - `page`: 页码，默认 0
  - `size`: 每页数量，默认 10
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/merchants/products?page=0&size=10" \
  -H "Authorization: Bearer token_0001"
```
- 返回示例：
```json
{
  "content": [
    {
      "id": 1,
      "brand": { "id": 1, "brandName": "Apple" },
      "series": { "id": 10, "seriesName": "iPhone" },
      "model": { "id": 100, "modelName": "iPhone 13" },
      "spec": { "id": 1000, "specName": "128GB" },
      "price": 5000,
      "stock": 10,
      "isValid": 1,
      "updateTime": "2026-01-14T10:00:00",
      "listingTime": "2026-01-14T09:00:00",
      "productType": 0,
      "cityCode": "310000",
      "description": "全新未拆封"
    }
  ],
  "pageable": {
    "sort": { "sorted": true, "unsorted": false, "empty": false },
    "offset": 0,
    "pageNumber": 0,
    "pageSize": 10,
    "paged": true,
    "unpaged": false
  },
  "totalPages": 5,
  "totalElements": 50,
  "last": false,
  "size": 10,
  "number": 0,
  "sort": { "sorted": true, "unsorted": false, "empty": false },
  "numberOfElements": 10,
  "first": true,
  "empty": false
}
```
- 说明：
  - 返回数据为 Spring Data JPA 的 `Page` 对象结构。
  - `content` 字段为商品列表。
  - 若商户会员已过期，返回 400 错误。



# 四、商家求购信息相关接口

## 1. 商家发布求购信息
- 方法与地址：`POST /api/merchants/products/buy`
- 功能：当前登录商户发布一条机型求购信息，成功后返回创建好的求购记录。
- 请求头：
  - `Authorization: Bearer <token>`
- 请求体字段：
  - `brandId`：品牌 ID（必填）
  - `seriesId`：系列 ID（必填）
  - `modelId`：型号 ID（必填）
  - `specId`：配置 ID（必填）
  - `productType`：产品类型（必填），`0` 新机，`1` 二手机
  - `buyCount`：求购数量（必填，>0 的整数）
  - `minPrice`：期望收货最低单价（必填，>0 的整数，单位：元）
  - `maxPrice`：期望收货最高单价（必填，>0 的整数，且 `maxPrice >= minPrice`）
  - `deadline`：求购截止时间（必填，ISO8601 格式，如 `"2026-01-31T23:59:59"`）
  - `costIntegral`：本次求购需要消耗的积分（必填，>=0 的整数）
- 特别说明：
  - `cityCode` 不需要前端传入，后端会自动使用商户当前城市编码。
  - 同一商户、同一机型（品牌+系列+型号+配置）最多只能存在一条有效求购信息；重复发布会返回 400 错误，错误信息为“该型号求购信息已存在”。
  - 若商户未登录，返回 401。
  - 若商户会员已过期，返回 400，错误信息为“商户会员已过期”。
- 请求体示例：
```json
{
  "brandId": 1,
  "seriesId": 10,
  "modelId": 100,
  "specId": 1000,
  "productType": 0,
  "buyCount": 5,
  "minPrice": 8000,
  "maxPrice": 9000,
  "deadline": "2026-01-31T23:59:59",
  "costIntegral": 100
}
```
- curl 示例：
```bash
curl -X POST "http://localhost:8083/api/merchants/products/buy" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer token_0001" \
  -d '{
    "brandId": 1,
    "seriesId": 10,
    "modelId": 100,
    "specId": 1000,
    "productType": 0,
    "buyCount": 5,
    "minPrice": 8000,
    "maxPrice": 9000,
    "deadline": "2026-01-31T23:59:59",
    "costIntegral": 100
  }'
```
- 返回示例：
```json
{
  "id": 1,
  "merchantId": 1,
  "brandId": 1,
  "seriesId": 10,
  "modelId": 100,
  "specId": 1000,
  "cityCode": "370100",
  "productType": 0,
  "buyCount": 5,
  "minPrice": 8000,
  "maxPrice": 9000,
  "deadline": "2026-01-31T23:59:59",
  "costIntegral": 100,
  "isValid": 1,
  "state": 0,
  "createTime": "2026-01-14T09:00:00",
  "updateTime": "2026-01-14T09:00:00"
}
```
- 说明：
  - 该接口只能操作当前登录商户自身的求购信息。
  - 若参数校验失败（如价格区间、数量、截止时间等），返回 400，并在错误信息中给出对应中文提示。

## 2. 删除商户发布的求购信息
- 方法与地址：`DELETE /api/merchants/products/buy/{buyRequestId}`
- 功能：删除当前登录商户已发布的某条求购信息，实际为逻辑删除（将 `isValid` 置为 `0`），后续查询接口将不再返回此条记录。
- 请求头：
  - `Authorization: Bearer <token>`
- 路径参数：
  - `buyRequestId`：求购信息 ID（必填）
- 行为说明：
  - 仅允许删除当前登录商户自己的求购信息，删除其他商户的求购信息会返回 400 错误（“无权操作该求购信息”）。
  - 若求购信息不存在，将返回 400 错误，错误信息为“求购信息不存在”。
  - 若该求购信息已是逻辑删除状态（`isValid=0`），再次删除不会报错，但不会产生任何实际效果。
- curl 示例：
```bash
curl -X DELETE "http://localhost:8083/api/merchants/products/buy/1" \
  -H "Authorization: Bearer token_0001"
```

## 3. 修改求购信息状态（上架 / 下架）
- 方法与地址：`PUT /api/merchants/products/buy/{buyRequestId}/state`
- 功能：修改当前登录商户某条求购信息的上架状态，仅修改 `state` 字段，不影响 `isValid`（是否已删除）。
- 请求头：
  - `Authorization: Bearer <token>`
- 路径参数：
  - `buyRequestId`：求购信息 ID（必填）
- 查询参数：
  - `state`：求购信息状态（必填）
    - `1`：上架（求购信息对外展示）
    - `0`：下架（求购信息对外不可见）
- 行为说明：
  - 仅允许操作当前登录商户自己的求购信息，否则返回 400 错误（“无权操作该求购信息”）。
  - 只能操作 `isValid=1` 的有效求购信息；若不存在或已删除，将返回 400 错误（“求购信息不存在”）。
  - 请求参数 `state` 只能为 `0` 或 `1`，否则返回 400 错误（“状态不合法”）。
- curl 示例（将求购信息下架）：
```bash
curl -X PUT "http://localhost:8083/api/merchants/products/buy/1/state?state=0" \
  -H "Authorization: Bearer token_0001"
```

## 4. 修改已存在的求购信息
- 方法与地址：`PUT /api/merchants/products/buy/{buyRequestId}`
- 功能：修改当前登录商户已存在的一条求购信息，修改完成后，该求购信息会自动变为下架状态（`state=0`），需要再手动调用状态接口将其上架。
- 请求头：
  - `Authorization: Bearer <token>`
- 路径参数：
  - `buyRequestId`：求购信息 ID（必填）
- 请求体：
  - 字段与「商家发布求购信息」接口相同（支持修改品牌、系列、型号、配置、求购数量、价格区间、截止时间、积分等字段）。
- 行为说明：
  - 仅允许修改当前登录商户自己的求购信息，否则返回 400 错误（“无权操作该求购信息”）。
  - 只能修改 `isValid=1` 的求购信息；不存在或已逻辑删除的记录会返回 400 错误（“求购信息不存在”）。
  - 修改成功后，系统会自动将 `state` 重置为 `0`（下架），需要再调用 `PUT /api/merchants/products/buy/{buyRequestId}/state` 将其上架。
- curl 示例：
```bash
curl -X PUT "http://localhost:8083/api/merchants/products/buy/1" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer token_0001" \
  -d '{
    "brandId": 1,
    "seriesId": 10,
    "modelId": 100,
    "specId": 1000,
    "productType": 0,
    "buyCount": 10,
    "minPrice": 7800,
    "maxPrice": 8800,
    "deadline": "2026-02-15T23:59:59",
    "costIntegral": 150
  }'
```

## 5. 按机型查询商户发布的求购信息
- 方法与地址：`GET /api/merchants/products/buy/model`
- 功能：根据品牌、系列、型号、配置查询当前登录商户的单条求购信息。前端常用此接口判断某个机型是否已经发布过求购：若存在则走修改流程，不存在才允许新增。
- 请求头：
  - `Authorization: Bearer <token>`
- 查询参数：
  - `brandId`：品牌 ID（必填）
  - `seriesId`：系列 ID（必填）
  - `modelId`：型号 ID（必填）
  - `specId`：配置 ID（必填）
- 行为说明：
  - 仅返回当前登录商户且 `isValid=1` 的求购信息。
  - 若对应求购信息不存在，将返回 400 错误，错误信息为“求购信息不存在”。
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/merchants/products/buy/model?brandId=1&seriesId=10&modelId=100&specId=1000" \
  -H "Authorization: Bearer token_0001"
```
- 返回示例：
```json
{
  "id": 1,
  "merchantId": 1,
  "brandId": 1,
  "seriesId": 10,
  "modelId": 100,
  "specId": 1000,
  "cityCode": "370100",
  "productType": 0,
  "buyCount": 10,
  "minPrice": 7800,
  "maxPrice": 8800,
  "deadline": "2026-02-15T23:59:59",
  "costIntegral": 150,
  "isValid": 1,
  "state": 1,
  "createTime": "2026-01-14T09:00:00",
  "updateTime": "2026-01-20T10:00:00"
}
```

## 6. 查询商户发布的求购信息列表
- 方法与地址：`GET /api/merchants/products/buy`
- 功能：分页查询当前登录商户发布的求购信息列表，按更新时间倒序排列。
- 请求头：
  - `Authorization: Bearer <token>`
- 查询参数：
  - `page`：页码，默认 0
  - `size`：每页数量，默认 10
- curl 示例：
```bash
curl -X GET "http://localhost:8083/api/merchants/products/buy?page=0&size=10" \
  -H "Authorization: Bearer token_0001"
```
- 返回示例：
```json
{
  "content": [
    {
      "id": 1,
      "merchantId": 1,
      "brandId": 1,
      "seriesId": 10,
      "modelId": 100,
      "specId": 1000,
      "cityCode": "370100",
      "productType": 0,
      "buyCount": 5,
      "minPrice": 8000,
      "maxPrice": 9000,
      "deadline": "2026-01-31T23:59:59",
      "costIntegral": 100,
      "isValid": 1,
      "state": 1,
      "createTime": "2026-01-14T09:00:00",
      "updateTime": "2026-01-14T10:00:00"
    }
  ],
  "pageable": {
    "sort": { "sorted": true, "unsorted": false, "empty": false },
    "offset": 0,
    "pageNumber": 0,
    "pageSize": 10,
    "paged": true,
    "unpaged": false
  },
  "totalPages": 3,
  "totalElements": 30,
  "last": false,
  "size": 10,
  "number": 0,
  "sort": { "sorted": true, "unsorted": false, "empty": false },
  "numberOfElements": 10,
  "first": true,
  "empty": false
}
```
- 说明：
  - 返回数据为 Spring Data JPA 的 `Page<BuyRequest>` 结构。
  - `content` 字段为求购信息列表，只包含当前登录商户且 `isValid=1` 的记录。
  - 若商户会员已过期，返回 400 错误。

# 五、搜索大厅相关接口

## 1. 查询上架产品列表

- **接口描述**：根据城市、新机/二手机类型、品牌、系列、型号、配置条件查询上架产品列表（支持分页）。
- **请求方式**：GET
- **接口地址**：`/api/supply/products`
- **请求头**：
  - `Authorization`: Token
- **请求参数**：

| 参数名 | 类型 | 必填 | 描述 |
| :--- | :--- | :--- | :--- |
| cityCode | String | 是 | 城市编码（"000000"或"全国"表示不限） |
| productType | Integer | 是 | 产品类型（0:新机, 1:二手机） |
| brandId | Long | 是 | 品牌ID |
| seriesId | Long | 是 | 系列ID |
| modelId | Long | 是 | 型号ID |
| specId | Long | 是 | 配置ID |
| page | Integer | 否 | 页码（从0开始，默认0） |
| size | Integer | 否 | 每页数量（默认10） |

- **CURL请求示例**：

```bash
curl -X GET 'http://localhost:8080/api/supply/products?cityCode=440300&productType=1&brandId=1&seriesId=2&modelId=3&specId=4&page=0&size=10' \
  -H 'Authorization: your_token_here'
```

- **响应结果**：

```json
{
  "content": [
    {
      "productId": 1,
      "merchantName": "示例商家",
      "merchantAddress": "示例地址",
      "merchantCity": "深圳市",
      "price": 5000,
      "secondHandCondition": "99新",
      "remark": "新机备注",
      "otherRemark": "其他备注",
      "listingTime": "2023-10-01T12:00:00"
    }
  ],
  "pageable": {
    "sort": {
      "empty": false,
      "sorted": true,
      "unsorted": false
    },
    "offset": 0,
    "pageNumber": 0,
    "pageSize": 10,
    "paged": true,
    "unpaged": false
  },
  "last": true,
  "totalPages": 1,
  "totalElements": 1,
  "size": 10,
  "number": 0,
  "sort": {
    "empty": false,
    "sorted": true,
    "unsorted": false
  },
  "first": true,
  "numberOfElements": 1,
  "empty": false
}
```

- **响应字段说明**：
  - 返回数据为 Spring Data JPA 的 `Page` 结构。
  - `content` 字段为产品列表，具体字段如下：

| 字段名 | 类型 | 描述 |
| :--- | :--- | :--- |
| productId | Long | 产品ID |
| merchantName | String | 商家名称 |
| merchantAddress | String | 商家地址 |
| merchantCity | String | 商家所在城市 |
| price | Integer | 价格 |
| secondHandCondition | String | 二手手机成色（仅二手机返回） |
| remark | String | 新机备注信息（仅新机返回） |
| otherRemark | String | 新机其它备注信息（仅新机返回） |
| listingTime | String | 上架时间 |

## 2. 查询上架产品详情

- **接口描述**：根据产品ID查询某个上架产品的详细信息。
- **请求方式**：GET
- **接口地址**：`/api/supply/products/{productId}`
- **请求头**：
  - `Authorization`: Token
- **路径参数**：

| 参数名 | 类型 | 必填 | 描述 |
| :--- | :--- | :--- | :--- |
| productId | Long | 是 | 产品ID |

- **CURL请求示例**：

```bash
curl -X GET 'http://localhost:8080/api/supply/products/1' \
  -H 'Authorization: your_token_here'
```

- **响应结果**：

```json
{
  "productId": 1,
  "brandId": 101,
  "seriesId": 201,
  "modelId": 301,
  "specId": 401,
  "brandName": "Apple",
  "seriesName": "iPhone 14",
  "modelName": "iPhone 14 Pro",
  "specName": "256G",
  "merchantName": "示例商家",
  "merchantAddress": "示例地址",
  "merchantCity": "深圳市",
  "price": 5000,
  "stock": 10,
  "secondHandCondition": "99新",
  "secondHandVersion": "国行",
  "secondHandFunction": "全功能",
  "remark": null,
  "otherRemark": null,
  "listingTime": "2023-10-01T12:00:00",
  "imageUrls": [
    "http://example.com/img1.jpg",
    "http://example.com/img2.jpg"
  ],
  "batteryStatus": 95
}
```

- **响应字段说明**：

| 字段名 | 类型 | 描述 |
| :--- | :--- | :--- |
| productId | Long | 产品ID |
| brandId | Long | 品牌ID |
| seriesId | Long | 系列ID |
| modelId | Long | 型号ID |
| specId | Long | 配置ID |
| brandName | String | 品牌名称 |
| seriesName | String | 系列名称 |
| modelName | String | 型号名称 |
| specName | String | 配置名称 |
| merchantName | String | 商家名称 |
| merchantAddress | String | 商家地址 |
| merchantCity | String | 商家所在城市 |
| price | Integer | 价格 |
| stock | Integer | 库存 |
| secondHandCondition | String | 二手手机成色（仅二手机） |
| secondHandVersion | String | 二手手机版本（仅二手机） |
| secondHandFunction | String | 二手手机功能描述（仅二手机） |
| remark | String | 新机备注信息（仅新机） |
| otherRemark | String | 新机其它备注信息（仅新机） |
| listingTime | String | 上架时间 |
| imageUrls | List<String> | 图片链接列表（仅二手机） |
| batteryStatus | Integer | 电池健康度（仅二手机） |

## 3. 查询商户电话信息

- **接口描述**：根据商户ID查询商户的电话信息，并记录调用日志。
- **请求方式**：GET
- **接口地址**：`/api/supply/merchant/phone`
- **请求头**：
  - `Authorization`: Token
- **请求参数**：

| 参数名 | 类型 | 必填 | 描述 |
| :--- | :--- | :--- | :--- |
| merchantId | Long | 是 | 目标商户ID |
| productId | Long | 是 | 关联产品ID |

- **CURL请求示例**：

```bash
curl -X GET 'http://localhost:8080/api/supply/merchant/phone?merchantId=1001&productId=1' \
  -H 'Authorization: your_token_here'
```

- **响应结果**：

```text
13800138000
```

- **响应说明**：直接返回商户电话字符串。

# 六、求购大厅相关接口

## 1. 查询求购大厅中的求购信息列表数据

- **接口描述**：查询当前城市中的求购信息列表。包含求购详细信息及部分脱敏的联系方式。
- **请求方式**：GET
- **接口地址**：`/api/supply/buy-requests`
- **请求头**：
  - `Authorization`: Token
- **请求参数**：

| 参数名 | 类型 | 必填 | 描述 |
| :--- | :--- | :--- | :--- |
| page | Integer | 否 | 页码（从0开始，默认0） |
| size | Integer | 否 | 每页数量（默认10） |

- **CURL请求示例**：

```bash
curl -X GET 'http://localhost:8080/api/supply/buy-requests?page=0&size=10' \
  -H 'Authorization: your_token_here'
```

- **响应结果**：

```json
{
  "content": [
    {
      "buyRequestId": 1,
      "merchantId": 1001,
      "brandId": 1,
      "seriesId": 2,
      "modelId": 3,
      "specId": 4,
      "brandName": "Apple",
      "seriesName": "iPhone 14",
      "modelName": "iPhone 14 Pro",
      "specName": "256G",
      "buyCount": 5,
      "minPrice": 4000,
      "maxPrice": 5000,
      "contactPhone": "138****8000",
      "contactAddress": "深圳市南山区...",
      "deadline": "2026-01-08 18:00"
    }
  ],
  "pageable": {
    "sort": {
      "empty": false,
      "sorted": true,
      "unsorted": false
    },
    "offset": 0,
    "pageNumber": 0,
    "pageSize": 10,
    "paged": true,
    "unpaged": false
  },
  "last": true,
  "totalPages": 1,
  "totalElements": 1,
  "size": 10,
  "number": 0,
  "sort": {
    "empty": false,
    "sorted": true,
    "unsorted": false
  },
  "first": true,
  "numberOfElements": 1,
  "empty": false
}
```

- **响应字段说明**：
  - 返回数据为 Spring Data JPA 的 `Page` 结构。
  - `content` 字段为求购信息列表，具体字段如下：

| 字段名 | 类型 | 描述 |
| :--- | :--- | :--- |
| buyRequestId | Long | 求购信息ID |
| merchantId | Long | 求购商户ID |
| brandId | Long | 品牌ID |
| seriesId | Long | 系列ID |
| modelId | Long | 型号ID |
| specId | Long | 配置ID |
| brandName | String | 品牌名称 |
| seriesName | String | 系列名称 |
| modelName | String | 型号名称 |
| specName | String | 配置名称 |
| buyCount | Integer | 求购数量 |
| minPrice | Integer | 最低价格 |
| maxPrice | Integer | 最高价格 |
| contactPhone | String | 联系电话（中间四位已脱敏） |
| contactAddress | String | 联系地址 |
| deadline | String | 截止时间（格式：yyyy-MM-dd HH:mm） |

## 2. 查询求购商户电话信息

- **接口描述**：根据求购商户ID查询商户的电话信息，同时记录调用日志。
- **请求方式**：GET
- **接口地址**：`/api/supply/merchant/buy-request/phone`
- **请求头**：
  - `Authorization`: Token
- **请求参数**：

| 参数名 | 类型 | 必填 | 描述 |
| :--- | :--- | :--- | :--- |
| merchantId | Long | 是 | 目标商户ID |
| buyRequestId | Long | 是 | 求购信息ID |

- **CURL请求示例**：

```bash
curl -X GET 'http://localhost:8080/api/supply/merchant/buy-request/phone?merchantId=1001&buyRequestId=1' \
  -H 'Authorization: your_token_here'
```

- **响应结果**：

```text
13800138000
```

- **响应说明**：直接返回商户电话字符串。

# 七、积分充值、会员充值接口

## 1. 创建微信充值订单

- **接口描述**：创建一笔积分或会员充值订单，返回订单号和金额，供前端调起微信支付。
- **请求方式**：POST
- **接口地址**：`/api/pay/wechat/recharge`
- **请求头**：
  - `Authorization`: Token
- **请求体参数**（JSON）：

| 参数名          | 类型    | 必填 | 描述                               |
| :------------- | :------ | :--- | :--------------------------------- |
| rechargeType   | Integer | 是   | 充值类型：1=积分充值，2=会员充值   |
| integralAmount | Integer | 否   | 充值积分数量，rechargeType=1 时必填 |
| memberMonths   | Integer | 否   | 充值会员月数，rechargeType=2 时必填 |
| totalAmount    | Integer | 是   | 支付金额（单位：分）               |

- **请求示例**：

```bash
curl -X POST 'http://localhost:8080/api/pay/wechat/recharge' \
  -H 'Authorization: your_token_here' \
  -H 'Content-Type: application/json' \
  -d '{
    "rechargeType": 1,
    "integralAmount": 100,
    "memberMonths": null,
    "totalAmount": 1000
  }'
```

- **响应结果示例**：

```json
{
  "orderNo": "202501151234567890abcdef",
  "totalAmount": 1000
}
```

- **响应说明**：
  - `orderNo`：本系统生成的充值订单号，用于后续微信支付以及支付回调识别订单。
  - `totalAmount`：本次充值的支付金额（单位：分）。
  - 若参数不合法，会返回 HTTP 400。
  - 若 `Authorization` 失效或缺失，会返回 HTTP 401。

## 2. 微信支付回调（服务端调用）

- **接口描述**：微信支付平台支付成功后回调该接口，系统根据订单号完成积分或会员充值。此接口由微信服务器调用，小程序前端无需调用。
- **请求方式**：POST
- **接口地址**：`/api/pay/wechat/notify`
- **请求体参数**（JSON，示例字段）：

| 参数名         | 类型    | 必填 | 描述                          |
| :------------ | :------ | :--- | :---------------------------- |
| outTradeNo    | String  | 是   | 商户订单号（系统订单号）      |
| transactionId | String  | 否   | 微信支付订单号                |
| totalAmount   | Integer | 是   | 实际支付金额（单位：分）      |
| tradeState    | String  | 是   | 支付状态，SUCCESS 表示支付成功 |

- **回调处理规则（简要说明）**：
  - 若 `tradeState` 不为 `SUCCESS`，接口直接返回 `"success"`，不做任何数据更新。
  - 若为 `SUCCESS`：
    - 根据 `outTradeNo` 查询充值订单。
    - 校验订单是否存在、是否未完成。
    - 校验回调金额 `totalAmount` 是否等于订单金额。
    - 根据订单类型完成相应充值：
      - 积分充值：增加会员积分，写入积分变动明细。
      - 会员充值：更新会员有效期与状态，刷新登录缓存。
    - 更新订单状态为已完成并保存微信订单号。

- **响应结果**：
  - 成功处理（包含非 SUCCESS 状态但格式正确）：HTTP 200，响应体 `"success"`。
  - 参数错误或订单校验失败：HTTP 400，响应体 `"invalid request"` 或 `"fail"`。

